<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--客户映射 指定到dao接口 -->
<mapper namespace="com.pm.dao.UserDao">

    <resultMap id="user" type="com.pm.entity.user.CoreUser">
        <id property="id" column="pm_userId"/>
        <result column="pm_userUsername" property="username"/>
        <result column="pm_userPassword" property="password"/>
        <result column="pm_userRealName" property="realName"/>
        <result column="pm_userHeadPortrait" property="headPortrait"/>
        <result column="pm_userNickname" property="nickname"/>
        <result column="pm_userPhoneNumber" property="phoneNumber"/>
        <result column="pm_userAuthority" property="authority"/>
        <result column="pm_userSalt" property="salt"/>
        <result column="pm_userIsLeader" property="isLeader"/>
        <result column="pm_userIsManager" property="isManager"/>
    </resultMap>

    <!--  用户查询字段  -->
    <sql id="user">
        pm_user.id as pm_userId,
        pm_user.username as pm_userUsername,
        pm_user.password as pm_userPassword,
        pm_user.real_name as pm_userRealName,
        pm_user.head_portrait as pm_userHeadPortrait,
        pm_user.nickname as pm_userNickname,
        pm_user.phone_number as pm_userPhoneNumber,
        pm_user.authority as pm_userAuthority,
        pm_user.salt as pm_userSalt,
        pm_user.is_leader as pm_userIsLeader,
        pm_user.is_manager as pm_userIsManager
    </sql>

    <!--  获取用户列表  -->
    <select id="getUserList" resultType="com.pm.entity.user.CoreUser">
        SELECT
        <include refid="user" />
        FROM pm_user
    </select>

    <select id="queryUserByUserName" resultMap="user">
        SELECT
        <include refid="user"/>
        FROM
        pm_user
        WHERE
        pm_user.username = #{username}
    </select>

    <!--  根据项目ID查询项目组成员  -->
    <select id="queryProjectMemberByProjectId" resultMap="user">
        SELECT
        <include refid="user" />
        FROM pm_user
        WHERE pm_user.id
        IN (
            SELECT
            pm_project_user.user_id
            FROM pm_project_user
            WHERE pm_project_user.project_id = #{projectId}
        )
    </select>

    <!--  根据任务ID查询任务组成员  -->
    <select id="queryTaskMemberByTaskId" resultMap="user">
        SELECT
        <include refid="user" />
        FROM pm_user
        WHERE pm_user.id
        IN (
            SELECT
            pm_task_cadre.task_cadre_id
            FROM pm_task_cadre
            WHERE pm_task_cadre.task_id = #{parentId}
        )
        OR pm_user.id
        IN (
            SELECT
            pm_task_member.task_member_id
            FROM pm_task_member
            WHERE pm_task_member.task_id = #{parentId}
        )
    </select>

</mapper>
